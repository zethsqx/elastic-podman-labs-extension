mkdir -p /home/student/es-lab/certs
cd /home/student/es-lab/certs

openssl genrsa -out ca.key 4096
openssl req -x509 -new -nodes -key ca.key -sha256 -days 3650 -out ca.crt -subj "/CN=es-lab-CA"

openssl genrsa -out es-wildcard.key 4096

cat > es-wildcard.cnf <<EOF
[ req ]
default_bits       = 4096
distinguished_name = dn
req_extensions     = ext
prompt             = no

[ dn ]
CN = *.es-lab.local

[ ext ]
subjectAltName = @alt_names

[ alt_names ]
DNS.1 = es01.es-lab.local
DNS.2 = es02.es-lab.local
DNS.3 = es03.es-lab.local
DNS.4 = hot01.es-lab.local
DNS.5 = es-lab.local
DNS.6 = *.es-lab.local
EOF

openssl req -new -key es-wildcard.key -out es-wildcard.csr -config es-wildcard.cnf
openssl x509 -req -in es-wildcard.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out es-wildcard.crt -days 825 -sha256 -extensions ext -extfile es-wildcard.cnf

cd /home/student/es-lab
chmod -R 640 *
